import{match as t}from"path-to-regexp";import e,{createContext as n,useContext as r,useState as i,useEffect as o,createElement as s}from"react";function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function h(t,e,n){return e&&a(t.prototype,e),n&&a(t,n),t}function c(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var s,u=t[Symbol.iterator]();!(r=(s=u.next()).done)&&(n.push(s.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==u.return||u.return()}finally{if(i)throw o}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var f=function(){function t(){u(this,t)}return h(t,[{key:"getCurrentRoute",value:function(){throw new Error("Method not implemented.")}},{key:"listenToPopState",value:function(){throw new Error("Method not implemented.")}},{key:"listenToPushState",value:function(){return!0}},{key:"pop",value:function(t,e){throw new Error("Method not implemented.")}},{key:"push",value:function(t,e){throw new Error("Method not implemented.")}},{key:"setSubscriber",value:function(t){}}]),t}();function d(t){return"/"!==t[0]?"/"+t:t}function p(e,n){if(n.path&&n.name)throw new Error("[matchRoute] Properties 'path' and 'name' cannot be given at the same time.");if(!n.path)return e.find((function(t){return t.name===n.name}))||!1;for(var r=0;r<e.length;r++){if("*"===e[r].path)return v(e[r],n.path);var i=t(d(e[r].path))(d(n.path));if(i)return v(e[r],n.path,i.params)}return null}var m=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[{},{}];u(this,t),this._subscriber=e,this._isListeningToPopState=n,this._isListeningToPushState=r,this._state=i}return h(t,[{key:"getCurrentRoute",value:function(){return this._state?this._state[0]:null}},{key:"listenToPopState",value:function(){return this._isListeningToPopState=!0,this._isListeningToPopState}},{key:"listenToPushState",value:function(){return this._isListeningToPushState=!0,this._isListeningToPushState}},{key:"pop",value:function(t,e){var n=p(t,e);if(!n)throw new Error("[Router] The given route is not defined in router config.");return this._isListeningToPopState&&this._subscriber(n,"pop"),!0}},{key:"push",value:function(t,e){var n=p(t,e);if(!n)throw new Error("[Router] The given route is not defined in router config.");return this._isListeningToPushState&&this._subscriber(n,"push"),!0}},{key:"setSubscriber",value:function(t){this._subscriber=t}}]),t}();function v(t,e,n){return n?Object.assign({},t,{matchedPath:e,params:n}):t}function y(t){if("hash"===t)return new f;if("history"===t)return new m;throw new Error("[Router] Unknown routing mode given: ".concat(t,". Available options are 'hash' and 'history' mode."))}var g=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];u(this,t),this._middlewareBefore=e,this._middlewareAfter=n}return h(t,[{key:"registerMiddlewareBefore",value:function(t){this._middlewareBefore.push(t)}},{key:"registerMiddlewareAfter",value:function(t){this._middlewareAfter.push(t)}},{key:"registerMiddleware",value:function(t){this.registerMiddlewareBefore(t)}},{key:"run",value:function(t){var e=this,n=t.from,r=t.to,i=t.type,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=this._middlewareBefore.concat(this._middlewareAfter);if(!(s.length<=0)){var u=o>=s.length-1,a=function(){};if(!u){var h=o+1;a=function(){e.run({from:n,to:r,type:i},h)}}s[o]({from:n,to:r,type:i,next:a})}}}]),t}();var w=function(){function t(e){var n=this;u(this,t),this._cbs=[],this._matches=[{},{}],this._middlewareContainer=new g,this.routes=e&&e.routes?e.routes:[],this._mode=e&&e.mode?y(e.mode):y("history"),this._mode.listenToPushState(),this._mode.listenToPopState(),this.middleware().registerMiddlewareAfter((function(t){var e=t.from,r=t.to,i=t.type;n._matches[0]=r,n._matches[1]=e,n._cbs.forEach((function(t){t(e,r)})),"push"===i&&window.history.pushState("","",r.matchedPath)})),window.addEventListener("popstate",this.pop.bind(this)),this._mode.setSubscriber((function(t,e){n._matches.length&&t.path===n._matches[0].path||n.middleware().run({from:n._matches.length?n._matches[0]:null,to:t,type:e})})),this.push({path:window.location.pathname})}return h(t,[{key:"getCurrentRoute",value:function(){return this._matches?this._matches[0]:null}},{key:"middleware",value:function(){return this._middlewareContainer}},{key:"pop",value:function(t){var e={path:window.location.pathname};return this._mode.pop(this.routes,e)}},{key:"push",value:function(t){return this._mode.push(this.routes,t)}},{key:"subscribe",value:function(t){this._cbs.push(t)}}]),t}();function b(t){return new w(t)}var _=n(null);function k(t){var n=t.children,r=t.router;return e.createElement(_.Provider,{value:r},n)}function T(t){var n=r(_);if(!n)throw new Error("[RouterLink] No RouterContext provided.");return e.createElement("a",{href:t.to.path,onClick:function(e){e.preventDefault(),n.push({path:t.to.path})}},t.children)}function S(t){var e=r(_);if(!e)throw new Error("[useRouteWatcher] The RouterContext is not provided.");var n=c(i({from:null,to:{component:e.getCurrentRoute().component}}),2),s=n[0],u=n[1];o((function(){e.subscribe((function(t,e){u({from:t,to:e})}))}),[null]),o((function(){t(s.from,s.to)}),[s])}function P(t){var n=c(i(""),2),r=n[0],o=n[1],u=c(i({}),2),a=u[0],h=u[1],l=null;return t.hasOwnProperty("transition")&&(l=t.transition),S((function(t,e){if(l){var n=l.duration||.4,r=l.style&&l.style.enterActive||{},i=l.style&&l.style.enter||{},s=l.style&&l.style.enterTo||{},u=l.style&&l.style.leaveActive||{},a=l.style&&l.style.leave||{},c=l.style&&l.style.leaveTo||{};h(Object.assign(Object.assign(Object.assign({transition:"".concat(n/2,"s")},u),a))),setTimeout((function(){h(Object.assign(Object.assign(Object.assign({transition:"".concat(n/2,"s")},u),c)))}),0),setTimeout((function(){o(e?e.component:null),h(Object.assign(Object.assign(Object.assign({transition:"".concat(n/2,"s")},r),i))),setTimeout((function(){h(Object.assign(Object.assign(Object.assign({transition:"".concat(n/2,"s")},r),s)))}),0),setTimeout((function(){h({})}),1e3*n/2)}),1e3*n/2)}else o(e?e.component:null)})),e.createElement("div",{style:a},r&&s(r))}function j(){return r(_).getCurrentRoute()}export{_ as RouterContext,T as RouterLink,k as RouterProvider,P as RouterView,b as createRouter,j as useCurrentRoute,S as useRouteWatcher};
