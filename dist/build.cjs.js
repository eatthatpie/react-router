"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t,e=require("path-to-regexp"),n=require("react"),r=(t=n)&&"object"==typeof t&&"default"in t?t.default:t;function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function u(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var u,s=t[Symbol.iterator]();!(r=(u=s.next()).done)&&(n.push(u.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var c=function(){function t(){o(this,t)}return u(t,[{key:"getCurrentRoute",value:function(){throw new Error("Method not implemented.")}},{key:"listenToPopState",value:function(){throw new Error("Method not implemented.")}},{key:"listenToPushState",value:function(){return!0}},{key:"pop",value:function(t,e){throw new Error("Method not implemented.")}},{key:"push",value:function(t,e){throw new Error("Method not implemented.")}},{key:"setSubscriber",value:function(t){}}]),t}();function h(t){return"/"!==t[0]?"/"+t:t}function l(t,n){if(n.path&&n.name)throw new Error("[matchRoute] Properties 'path' and 'name' cannot be given at the same time.");if(!n.path)return t.find((function(t){return t.name===n.name}))||!1;for(var r=0;r<t.length;r++){if("*"===t[r].path)return d(t[r],n.path);var o=e.match(h(t[r].path))(h(n.path));if(o)return d(t[r],n.path,o.params)}return null}var f=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[{},{}];o(this,t),this._subscriber=e,this._isListeningToPopState=n,this._isListeningToPushState=r,this._state=i}return u(t,[{key:"getCurrentRoute",value:function(){return this._state?this._state[0]:null}},{key:"listenToPopState",value:function(){return this._isListeningToPopState=!0,this._isListeningToPopState}},{key:"listenToPushState",value:function(){return this._isListeningToPushState=!0,this._isListeningToPushState}},{key:"pop",value:function(t,e){var n=l(t,e);if(!n)throw new Error("[Router] The given route is not defined in router config.");return this._isListeningToPopState&&this._subscriber(n,"pop"),!0}},{key:"push",value:function(t,e){var n=l(t,e);if(!n)throw new Error("[Router] The given route is not defined in router config.");return this._isListeningToPushState&&this._subscriber(n,"push"),!0}},{key:"setSubscriber",value:function(t){this._subscriber=t}}]),t}();function d(t,e,n){return n?Object.assign({},t,{matchedPath:e,params:n}):t}function p(t){if("hash"===t)return new c;if("history"===t)return new f;throw new Error("[Router] Unknown routing mode given: ".concat(t,". Available options are 'hash' and 'history' mode."))}var m=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];o(this,t),this._middlewareBefore=e,this._middlewareAfter=n}return u(t,[{key:"registerMiddlewareBefore",value:function(t){this._middlewareBefore.push(t)}},{key:"registerMiddlewareAfter",value:function(t){this._middlewareAfter.push(t)}},{key:"registerMiddleware",value:function(t){this.registerMiddlewareBefore(t)}},{key:"run",value:function(t){var e=this,n=t.from,r=t.to,o=t.type,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=this._middlewareBefore.concat(this._middlewareAfter);if(!(u.length<=0)){var s=i>=u.length-1,a=function(){};if(!s){var c=i+1;a=function(){e.run({from:n,to:r,type:o},c)}}u[i]({from:n,to:r,type:o,next:a})}}}]),t}();var v=function(){function t(e){var n=this;o(this,t),this._cbs=[],this._matches=[{},{}],this._middlewareContainer=new m,this.routes=e&&e.routes?e.routes:[],this._mode=e&&e.mode?p(e.mode):p("history"),this._mode.listenToPushState(),this._mode.listenToPopState(),this.middleware().registerMiddlewareAfter((function(t){var e=t.from,r=t.to,o=t.type;n._matches[0]=r,n._matches[1]=e,n._cbs.forEach((function(t){t(e,r)})),"push"===o&&window.history.pushState("","",r.matchedPath)})),window.addEventListener("popstate",this.pop.bind(this)),this._mode.setSubscriber((function(t,e){n._matches.length&&t.path===n._matches[0].path||n.middleware().run({from:n._matches.length?n._matches[0]:null,to:t,type:e})})),this.push({path:window.location.pathname})}return u(t,[{key:"getCurrentRoute",value:function(){return this._matches?this._matches[0]:null}},{key:"middleware",value:function(){return this._middlewareContainer}},{key:"pop",value:function(t){var e={path:window.location.pathname};return this._mode.pop(this.routes,e)}},{key:"push",value:function(t){return this._mode.push(this.routes,t)}},{key:"subscribe",value:function(t){this._cbs.push(t)}}]),t}();var y=n.createContext(null);function g(t){var e=n.useContext(y);if(!e)throw new Error("[useRouteWatcher] The RouterContext is not provided.");var r=s(n.useState({from:null,to:{component:e.getCurrentRoute().component}}),2),o=r[0],i=r[1];n.useEffect((function(){e.subscribe((function(t,e){i({from:t,to:e})}))}),[null]),n.useEffect((function(){t(o.from,o.to)}),[o])}exports.RouterContext=y,exports.RouterLink=function(t){var e=n.useContext(y);if(!e)throw new Error("[RouterLink] No RouterContext provided.");return r.createElement("a",{href:t.to.path,onClick:function(n){n.preventDefault(),e.push({path:t.to.path})}},t.children)},exports.RouterProvider=function(t){var e=t.children,n=t.router;return r.createElement(y.Provider,{value:n},e)},exports.RouterView=function(t){var e=s(n.useState(""),2),o=e[0],i=e[1],u=s(n.useState({}),2),a=u[0],c=u[1],h=null;return t.hasOwnProperty("transition")&&(h=t.transition),g((function(t,e){if(h){var n=h.duration||.4,r=h.style&&h.style.enterActive||{},o=h.style&&h.style.enter||{},u=h.style&&h.style.enterTo||{},s=h.style&&h.style.leaveActive||{},a=h.style&&h.style.leave||{},l=h.style&&h.style.leaveTo||{};c(Object.assign(Object.assign(Object.assign({transition:"".concat(n/2,"s")},s),a))),setTimeout((function(){c(Object.assign(Object.assign(Object.assign({transition:"".concat(n/2,"s")},s),l)))}),0),setTimeout((function(){i(e?e.component:null),c(Object.assign(Object.assign(Object.assign({transition:"".concat(n/2,"s")},r),o))),setTimeout((function(){c(Object.assign(Object.assign(Object.assign({transition:"".concat(n/2,"s")},r),u)))}),0),setTimeout((function(){c({})}),1e3*n/2)}),1e3*n/2)}else i(e?e.component:null)})),r.createElement("div",{style:a},o&&n.createElement(o))},exports.createRouter=function(t){return new v(t)},exports.useCurrentRoute=function(){return n.useContext(y).getCurrentRoute()},exports.useRouteWatcher=g;
