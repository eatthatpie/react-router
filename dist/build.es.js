import{match as t}from"path-to-regexp";import e,{createContext as n,useContext as o,useState as r,useEffect as i,createElement as u}from"react";function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function h(t,e,n){return e&&s(t.prototype,e),n&&s(t,n),t}function c(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t))&&"[object Arguments]"!==Object.prototype.toString.call(t))return;var n=[],o=!0,r=!1,i=void 0;try{for(var u,a=t[Symbol.iterator]();!(o=(u=a.next()).done)&&(n.push(u.value),!e||n.length!==e);o=!0);}catch(t){r=!0,i=t}finally{try{o||null==a.return||a.return()}finally{if(r)throw i}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function f(t){return"/"!==t[0]?"/"+t:t}var p=function(){function t(){a(this,t)}return h(t,[{key:"getCurrentRoute",value:function(){throw new Error("Method not implemented.")}},{key:"listenToPopState",value:function(){throw new Error("Method not implemented.")}},{key:"listenToPushState",value:function(){return!0}},{key:"pop",value:function(t){throw new Error("Method not implemented.")}},{key:"push",value:function(t){window.location.hash=t.path}},{key:"subscribe",value:function(t){}}]),t}(),l=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[{},{}];a(this,t),this._cbs=e,this._isListeningToPopState=n,this._isListeningToPushState=o,this._state=r}return h(t,[{key:"getCurrentRoute",value:function(){return this._state?this._state[0]:null}},{key:"listenToPopState",value:function(){return this._isListeningToPopState=!0,this._isListeningToPopState}},{key:"listenToPushState",value:function(){return this._isListeningToPushState=!0,this._isListeningToPushState}},{key:"pop",value:function(t){var e=this;this._state[1]=Object.assign({},this._state[0]),this._state[0]=Object.assign({},t),this._isListeningToPopState&&this._cbs.forEach((function(t){t(e._state)}))}},{key:"push",value:function(t){var e=this;this._state&&t.path===this._state[0].path||(window.history.pushState("","",t.matchedPath),this._state[1]=Object.assign({},this._state[0]),this._state[0]=Object.assign({},t),this._isListeningToPushState&&this._cbs.forEach((function(t){t(e._state)})))}},{key:"subscribe",value:function(t){this._cbs.push(t)}}]),t}();function v(t,e,n){return n?Object.assign({},t,{matchedPath:e,params:n}):t}function d(t){if("hash"===t)return new p;if("history"===t)return new l;throw new Error("[Router] Unknown routing mode given: ".concat(t,". Available options are 'hash' and 'history' mode."))}function m(e,n){if(n.path&&n.name)throw new Error("[matchRoute] Properties 'path' and 'name' cannot be given at the same time.");if(!n.path)return e.find((function(t){return t.name===n.name}))||!1;for(var o=0;o<e.length;o++){if("*"===e[o].path)return v(e[o],n.path);var r=t(f(e[o].path))(f(n.path));if(r)return v(e[o],n.path,r.params)}return!1}var w=function(){function t(e){a(this,t),this._routes=e&&e.routes?e.routes:[],this._mode=e&&e.mode?d(e.mode):d("history"),this.push({path:window.location.pathname}),this._mode.listenToPushState(),this._mode.listenToPopState(),window.addEventListener("popstate",this.pop.bind(this))}return h(t,[{key:"getCurrentRoute",value:function(){return this._mode.getCurrentRoute()}},{key:"pop",value:function(t){var e={path:window.location.pathname},n=m(this._routes,e);if(!n)throw new Error("[Router] The given route is not defined in router config.");return this._mode.pop(n),!0}},{key:"push",value:function(t){var e=m(this._routes,t);if(!e)throw new Error("[Router] The given route is not defined in router config.");return this._mode.push(e),!0}},{key:"subscribe",value:function(t){this._mode.subscribe(t)}}]),t}();function g(t){return new w(t)}var _=n(null);function y(t){var n=o(_);if(!n)throw new Error("[RouterLink] No RouterContext provided.");return e.createElement("a",{href:t.to.path,onClick:function(e){e.preventDefault(),n.push({path:t.to.path})}},t.children)}function b(){var t=c(r(""),2),e=t[0],n=t[1];return function(t){var e=o(_);if(!e)throw new Error("[useRouteWatcher] The RouterContext is not provided.");var n=c(r({from:null,to:{component:e.getCurrentRoute().component}}),2),u=n[0],a=n[1];e.subscribe((function(t){a({from:t[1],to:t[0]})})),i((function(){t(u.from,u.to)}),[u])}((function(t,e){n(e?e.component:null)})),e&&u(e)}export{_ as RouterContext,y as RouterLink,b as RouterView,g as createRouter};
